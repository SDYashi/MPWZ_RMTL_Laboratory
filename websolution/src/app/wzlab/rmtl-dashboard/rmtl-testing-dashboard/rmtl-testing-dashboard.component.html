<div class="container-fluid py-2">
 <!-- Dashboard Header -->
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
  <div class="d-flex align-items-center">
    <img src="../../../assets/icons/wzlogo.png" alt="" height="40px" width="40px" class="me-2">
    <h4 class="fw-bold mb-0 text-uppercase dashboard-title" style="color: rgb(172, 97, 11); margin-left: 15px;">Testing Dashboard</h4>
  </div>
</div>

<!-- Filter Card -->
<div class="card shadow-sm border-0 mb-4">
  <div class="card-body">
    <div class="row g-3 align-items-end">

      <!-- From Date -->
      <div class="col-12 col-sm-6 col-md-4">
        <label class="form-label fw-semibold">From Date</label>
        <input
          type="date"
          class="form-control"
          [(ngModel)]="filters.start_date"
          (change)="onDateChange()"
        />
      </div>

      <!-- To Date -->
      <div class="col-12 col-sm-6 col-md-4">
        <label class="form-label fw-semibold">To Date</label>
        <input
          type="date"
          class="form-control"
          [(ngModel)]="filters.end_date"
          (change)="onDateChange()"
        />
      </div>

      <!-- Lab Select -->
      <!-- <div class="col-12 col-md-4">
        <label class="form-label fw-semibold">Select Lab</label>
        <select
          class="form-select"
          [(ngModel)]="filters.lab_id"
          (change)="onLabChange()"
        >
          <option value="">All Labs</option>
          <option *ngFor="let lab of labs" [value]="lab.id">
            {{ lab.lab_name }}
          </option>
        </select>
      </div> -->

    </div>
  </div>
</div>

  <div *ngIf="isLoading" class="alert alert-light border d-flex align-items-center gap-2">
    <i class="fas fa-spinner fa-spin"></i>
    <span>Loading testing dashboardâ€¦</span>
  </div>

  <div *ngIf="!isLoading && error" class="alert alert-danger">{{ error }}</div>

  <div *ngIf="!isLoading && !error && testingData">

    <div class="row g-3">
      <div class="col-6 col-md-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="text-muted small">Total Assigned</div>
            <div class="h5 fw-bold mb-0">{{ number(testingData.counts?.total_assigned) }}</div>
          </div>
        </div>
      </div>

      <div class="col-6 col-md-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="text-muted small">Total Tested</div>
            <div class="h5 fw-bold mb-0">{{ number(testingData.counts?.total_tested) }}</div>
          </div>
        </div>
      </div>

      <div class="col-6 col-md-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="text-muted small">Pending For Tested</div>
            <div class="h5 fw-bold mb-0">{{ number(testingData.counts?.pending_for_tested) }}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card shadow-sm border-0 mt-3">
      <div class="card-header bg-white fw-semibold">Pending Assignments For Testing</div>
      <div class="card-body table-responsive">
        <table class="table table-sm table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>Serial</th>
              <th>Inward No</th>
              <th>Inward Date</th>
              <th>Purpose</th>
              <th>Category</th>
              <th>Phase</th>
              <th>Assigned Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let d of testingData.pending_devices">
              <td>{{ d.serial_number }}</td>
              <td>{{ d.inward_number }}</td>
              <td>{{ d.inward_date }}</td>
              <td>{{ d.device_testing_purpose }}</td>
              <td>{{ d.meter_category }}</td>
              <td>{{ d.phase }}</td>
              <td>{{ d.assigned_datetime }}</td>
            </tr>
            <tr *ngIf="(testingData.pending_devices?.length || 0) === 0">
              <td colspan="7" class="text-center text-muted">No pending assignments</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>
