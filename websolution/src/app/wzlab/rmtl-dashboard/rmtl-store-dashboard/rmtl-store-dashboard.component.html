<div class="container-fluid py-2">
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
  <div class="d-flex align-items-center">
    <img src="../../../assets/icons/wzlogo.png" alt="" height="40px" width="40px" class="me-2">
    <h4 class="fw-bold mb-0 text-uppercase dashboard-title" style="color: rgb(172, 97, 11); margin-left: 15px;">RMTL Store Dashboard</h4>
  </div>
</div>
  <!-- Filters -->
  <div class="row g-2 mb-3">
    <div class="col-12 col-md-3">
      <label class="form-label"><b>From Date</b></label>
      <input type="date" class="form-control" [(ngModel)]="filters.start_date" (change)="onDateChange()">
    </div>

    <div class="col-12 col-md-3">
      <label class="form-label"><b>To Date</b></label>
      <input type="date" class="form-control" [(ngModel)]="filters.end_date" (change)="onDateChange()">
    </div>

      <div class="col-12 col-sm-6 col-md-4 d-flex align-items-end">
        <div class="input-group">
        <span class="input-group-text"><i class="fas fa-search"></i></span>
        <input type="text" class="form-control" placeholder="Search by serial no, name, or comment" [(ngModel)]="filters.search">
        <button class="btn btn-primary" type="button" (click)="onSearchChanged()">Search</button>
      </div>
    </div>
  </div>
    <hr>
  <div *ngIf="isLoading" class="alert alert-light border d-flex align-items-center gap-2">
    <i class="fas fa-spinner fa-spin"></i>
    <span>Loading store dashboardâ€¦</span>
  </div>

  <div *ngIf="!isLoading && error" class="alert alert-danger">{{ error }}</div>

  <div *ngIf="!isLoading && !error && storeData">

    <div class="row g-3">
      <div class="col-6 col-md-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body" style="background: linear-gradient(135deg, #edf4ff, #dfeaff);">
            <div class="text-muted fw-bold">Total Inwards</div>
            <div class="h5 fw-bold mb-0">{{ number(storeData.counts?.total_inwards) }}</div>
          </div>
        </div>
      </div>

      <div class="col-6 col-md-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body" style="background: linear-gradient(135deg, #eafaf8, #d6f5f2);">
            <div class="text-muted fw-bold">Total Dispatched</div>
            <div class="h5 fw-bold mb-0">{{ number(storeData.counts?.total_dispatched) }}</div>
          </div>
        </div>
      </div>

      <div class="col-6 col-md-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body" style="background: linear-gradient(135deg, #f6f2ff, #ebe4ff);">
            <div class="text-muted fw-bold">Pending Assignment</div>
            <div class="h5 fw-bold mb-0">{{ number(storeData.counts?.pending_for_assignment) }}</div>
          </div>
        </div>
      </div>

      <div class="col-6 col-md-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body" style="background: linear-gradient(135deg, #f4f8f1, #e5f0dd);">
            <div class="text-muted fw-bold">Pending Dispatch After Approval</div>
            <div class="h5 fw-bold mb-0">{{ number(storeData.counts?.pending_for_dispatch_after_testing_done) }}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card shadow-sm border-0 mt-3">
      <div class="card-header fw-semibold" style="background-color: rgb(99, 175, 139);color: whitesmoke;">Store Pending Devices</div>
      <div class="card-body table-responsive">
<table class="table table-sm table-bordered align-middle">
  <thead class="table-light">
    <tr>
      <th>#</th>
      <th>Serial</th>
      <th>Inward No</th>
      <th>Inward Date</th>
      <th>Purpose</th>
      <th>Category</th>
      <th>Phase</th>
    </tr>
  </thead>

  <tbody>
    <tr *ngFor="let d of storeData.pending_devices; let i = index">
      <!-- Serial number -->
      <td>{{ i + 1 }}</td>

      <td>{{ d.serial_number }}</td>
      <td>{{ d.inward_number }}</td>
      <td>{{ d.inward_date | date:'dd-MM-yyyy' }}</td>

      <!-- Enum cleanup -->
      <td>{{ d.device_testing_purpose?.split('.').pop() }}</td>
      <td>{{ d.meter_category?.split('.').pop() }}</td>
      <td>{{ d.phase?.split('.').pop() }}</td>
    </tr>

    <tr *ngIf="(storeData.pending_devices?.length || 0) === 0">
      <td colspan="7" class="text-center text-muted">
        No pending devices
      </td>
    </tr>
  </tbody>
</table>

      </div>
    </div>

  </div>
</div>
